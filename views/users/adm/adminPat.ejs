<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - DoctorSync</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/users.css">
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
</head>

<body class="bg-gray-100 min-h-screen font-sans antialiased">
     <!-- Hamburger Menu -->
    <%- include('nav') -%>
       
    <!-- Patients Section -->
    <h2 class="text-xl font-bold mb-4 text-gray-800">Patient Management</h2>
    <div class="bg-white rounded-lg shadow overflow-hidden w-full">
        <table class="data-table">
            <thead>
                <tr>
                    <th class="text-left">PatientID</th>
                    <th class="text-left">Name</th>
                    <th class="text-left">Address</th>
                    <th class="text-left">Phone</th>
                    <th class="text-left">DOB</th>
                    <th class="text-left">Blood Group</th>
                    <th class="text-left">Actions</th>
                </tr>
            </thead>
            <tbody>
                <% 
                const activePat = patientList?.filter(patient => patient.Flag === 0); 
                if (activePat?.length > 0) { 
                %>

                <% activePat.forEach(patient => { %>
                        <tr>
                            <td><%= patient.PatientID %></td>
                            <td><%= patient.Name %></td>
                            <td><%= patient.Address %></td>
                            <td><%= patient.Phone %></td>
                            <td><%= new Date(patient.DOB).toLocaleDateString('en-GB').split('/').join('-') %></td>
                            <td><%= patient.BloodGroup %></td>
                            <td>
                                <button id="deletePatientBtn" data-refid="<%= patient.UserID %>"
                                class="btn btn-danger" target="_blank">
                            <i data-feather="trash-2" class="w-4 h-4 mr-2"></i> Deactivate
                        </button>
                            </td>
                        </tr>
                    <% }) %>
                <% } else { %>
                    <tr>
                        <td colspan="7" class="text-center py-4">No patients available</td>
                    </tr>
                <% } %>
            </tbody>
        </table>
    </div>

    </main>

    </div>
    <script src="/javascripts/adminHelp.js"></script>
       <script>
    
    document.querySelectorAll('#deletePatientBtn').forEach(button => {
    button.addEventListener('click', (event) => {
        const userId = event.currentTarget.getAttribute('data-refid');
        if(userId){
            window.open(`/admin/deactivate/${userId}`, '_blank');
        }
    });
});
   </script>
    <!-- <script>
        // Initialize Feather Icons
        feather.replace();
        // Sidebar functionality
        document.addEventListener('DOMContentLoaded', () => {
        const sidebar = document.getElementById('sidebar');
        const hamburger = document.getElementById('hamburger');
        const closeIcon = document.getElementById('close-icon');

        const navItems = document.querySelectorAll('.nav-item');
        const sections = document.querySelectorAll('main > section');

        function toggleSidebar() {
            sidebar.classList.toggle('open');
        }

        function closeSidebar() {
            sidebar.classList.remove('open');
        }

        hamburger.addEventListener('click', toggleSidebar);
        closeIcon.addEventListener('click', closeSidebar);

    });

        // Delete functionality
        function deleteItem(type, id) {
            if (!confirm(`Are you sure you want to delete this ${type}?`)) {
                return;
            }

            fetch(`/delete-${type}/${id}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                credentials: 'include'
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(error => {
                        throw new Error(error.message || 'Error occurred');
                    });
                }
                return response.json();
            })
            .then(data => {
                alert(data.message || `${type} deleted successfully`);
                window.location.reload();
            })
            .catch(error => {
                console.error(`Error deleting ${type}:`, error);
                alert(`Failed to delete ${type}: ${error.message}`);
            });
        } 
    </script> -->
</body>
</html>


