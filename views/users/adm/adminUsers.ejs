<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - DoctorSync</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/users.css">
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
</head>

<body class="bg-gray-100 min-h-screen font-sans antialiased">
     <%- include('nav') -%>

    <h2 class="text-xl font-bold mb-4 text-gray-800">User Management</h2>
    <div class="bg-white rounded-lg shadow overflow-hidden w-full">
        <table class="data-table">
            <thead>
                <tr>
                    <th class="text-left">UserID</th>
                    <th class="text-left">Username</th>
                    <th class="text-left">Email</th>
                    <th class="text-left">Role</th>
                    <th class="text-left">Actions</th>
                </tr>
            </thead>
            <tbody>
                <% 
                    const activeUsers = userList?.filter(user => user.Flag === 0); 
                    if (activeUsers?.length > 0) { 
                %>
                    <% activeUsers.forEach(user => { %>
                        <tr>
                            <td><%= user.UserID %></td>
                            <td><%= user.Username %></td>
                            <td><%= user.Email %></td>
                            <td><%= user.Role %></td>
                            <td>
                                <button id="deleteUserBtn" data-refid="<%= user.UserID %>"
                                class="btn btn-danger" target="_blank">
                            <i data-feather="trash-2" class="w-4 h-4 mr-2"></i> Deactivate
                        </button>
                            </td>
                        </tr>
                    <% }) %>
                <% } else { %>
                    <tr>
                        <td colspan="5" class="text-center py-4">No users available</td>
                    </tr>
                <% } %>
            </tbody>
            
        </table>
    </div>

</main>

</div>
<script src="/javascripts/adminHelp.js"></script>
<script>
// Initialize Feather Icons
feather.replace();
// Sidebar functionality
document.addEventListener('DOMContentLoaded', () => {
const sidebar = document.getElementById('sidebar');
const hamburger = document.getElementById('hamburger');
const closeIcon = document.getElementById('close-icon');

const navItems = document.querySelectorAll('.nav-item');
const sections = document.querySelectorAll('main > section');

function toggleSidebar() {
    sidebar.classList.toggle('open');
}

function closeSidebar() {
    sidebar.classList.remove('open');
}

hamburger.addEventListener('click', toggleSidebar);
closeIcon.addEventListener('click', closeSidebar);

});

// Delete functionality
function deleteItem(type, id) {
    if (!confirm(`Are you sure you want to delete this ${type}?`)) {
        return;
    }

    fetch(`/delete-${type}/${id}`, {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        },
        credentials: 'include'
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(error => {
                throw new Error(error.message || 'Error occurred');
            });
        }
        return response.json();
    })
    .then(data => {
        alert(data.message || `${type} deleted successfully`);
        window.location.reload();
    })
    .catch(error => {
        console.error(`Error deleting ${type}:`, error);
        alert(`Failed to delete ${type}: ${error.message}`);
    });
} 

    document.querySelectorAll('#deleteUserBtn').forEach(button => {
    button.addEventListener('click', (event) => {
        const userId = event.currentTarget.getAttribute('data-refid');
        if(userId){
            window.open(`/admin/deactivate/${userId}`, '_blank');
        }
    });
});
</script> 
</body>
</html>

