<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Show medical data</title>
</head>
<body class="bg-gray-100 p-8">
    <div class="container mx-auto">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Medicine Name</label>
            <div class="relative">
              <input type="text" id="medName" name="patientName" required 
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                    autocomplete="off">
              <div id="suggestMed" class="absolute z-10 bg-white border border-gray-300 w-full rounded-md mt-1 hidden shadow-lg max-h-60 overflow-y-auto"></div>
            </div>
            <input type="hidden" id="hiddenMed" name="PatientID">
          </div>

        <!-- Medical Data Table -->
        <div class="mb-8">
            <h2 class="text-2xl font-bold mb-4">Medical Data</h2>
            <div class="overflow-x-auto bg-white rounded-lg shadow">
                <table class="min-w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left">Name</th>
                            <th class="px-4 py-2 text-left">price(Rs.)</th>
                            <th class="px-4 py-2 text-left">Manufacturer</th>
                            <th class="px-4 py-2 text-left">Pack Size</th>
                            <th class="px-4 py-2 text-left">Composition</th>
                            
                        </tr>
                    </thead>
                    <tbody>
                        <% medData.forEach(medData => { %>
                            <tr class="border-t">
                                <td class="px-4 py-2"><%= medData.name %></td>
                                <td class="px-4 py-2"><%= medData.price %></td>
                                <td class="px-4 py-2"><%= medData.manufacturer_name %></td>
                                <td class="px-4 py-2"><%= medData.pack_size_label %></td>
                                <td class="px-4 py-2"><%= medData.short_composition1  %></td>
                            </tr>
                        <% }) %>
                    </tbody>

                    
                </table>
            </div>
        </div>

    </div>

    <script>
        function setupPatientSearch(inputId, suggestionsId, hiddenId) {
    const input = document.getElementById(inputId);
    const suggestions = document.getElementById(suggestionsId);
    
    input.addEventListener("input", function() {
        let query = this.value.trim();
        if (query.length < 2) {
            suggestions.classList.add("hidden");
            return;
        }

        fetch(`/search-med?query=${query}`)
            .then(response => response.json())
            .then(data => {
                suggestions.innerHTML = "";
                if (data.length === 0) {
                    suggestions.innerHTML = "<div class='p-2 text-gray-500'>No medicines found</div>";
                } else {
                    data.forEach(medicines => {
                        let div = document.createElement("div");
                        div.classList.add("p-2", "cursor-pointer", "hover:bg-gray-100");
                        div.innerText = medicines.name;
                        div.onclick = function() {
                            input.value = medicines.name;
                        };
                        suggestions.appendChild(div);
                    });
                }
            })
            .catch(error => console.error("Error fetching medicines:", error));
    });

    // Close suggestions when clicking outside
    document.addEventListener('click', function(event) {
        if (!input.contains(event.target) && !suggestions.contains(event.target)) {
            suggestions.classList.add("hidden");
        }
    });
}

// Initialize all search inputs
document.addEventListener('DOMContentLoaded', function() {
    // Initialize the patient search input
    setupPatientSearch('medName', 'suggestMed', 'hiddenMed');
});
    </script>
</body>

</html>